package fr.ign.cogit;

import fr.ign.cogit.geoxygene.api.feature.IFeature;
import fr.ign.cogit.geoxygene.api.feature.IFeatureCollection;
import fr.ign.cogit.geoxygene.api.spatial.coordgeom.IPolygon;
import fr.ign.cogit.geoxygene.api.spatial.geomaggr.IMultiCurve;
import fr.ign.cogit.geoxygene.api.spatial.geomprim.IOrientableCurve;
import fr.ign.cogit.geoxygene.convert.FromGeomToSurface;
import fr.ign.cogit.geoxygene.sig3d.calculation.parcelDecomposition.OBBBlockDecomposition;
import fr.ign.cogit.geoxygene.spatial.coordgeom.DirectPosition;
import fr.ign.cogit.geoxygene.util.conversion.ShapefileWriter;
import fr.ign.cogit.geoxygene.util.conversion.WktGeOxygene;

public class Test {


	public static void main(String[] args) throws Exception {
		
		DirectPosition.PRECISION = 5;
 		String strMuliPol = "POLYGON ((928424.77000000001862645 6693745.7900000000372529, 928417.68000000005122274 6693740.29999999981373549, 928417.40000000002328306 6693740.58999999985098839, 928400.03000000002793968 6693762.83999999985098839, 928387.96999999997206032 6693778.08000000007450581, 928379.80000000004656613 6693772.44000000040978193, 928376.61999999999534339 6693775.76999999955296516, 928370.91000000003259629 6693781.9599999999627471, 928365.4599999999627471 6693788.05999999959021807, 928372.57999999995809048 6693793.33000000007450581, 928379.44999999995343387 6693798.2900000000372529, 928397.72999999998137355 6693811.82000000029802322, 928401.43000000005122274 6693814.55999999959021807, 928409.81000000005587935 6693813.11000000033527613, 928412.88000000000465661 6693811.12999999988824129, 928415.85999999998603016 6693809, 928417.5400000000372529 6693807.70000000018626451, 928424.96999999997206032 6693801.67999999970197678, 928430.68000000005122274 6693796.12999999988824129, 928432.56000000005587935 6693793.84999999962747097, 928434.58999999996740371 6693791.65000000037252903, 928437.18999999994412065 6693789.16000000014901161, 928439.36999999999534339 6693787.5400000000372529, 928442.06999999994877726 6693785.80999999959021807, 928439.15000000002328306 6693783.36000000033527613, 928433.97999999998137355 6693779.67999999970197678, 928428.90000000002328306 6693775.87999999988824129, 928425.59999999997671694 6693773.2900000000372529, 928423.19999999995343387 6693771.55999999959021807, 928411.72999999998137355 6693762.98000000044703484, 928423.90000000002328306 6693746.91999999992549419, 928424.77000000001862645 6693745.7900000000372529))";
 		 double roadEpsilon = 0;
         double noise = 0;
        double maximalArea = 1200;
        double maximalWidth = 50;
		
		// Exterior from the UrbanBlock if necessary or null
		IMultiCurve<IOrientableCurve> imC = null;
		// Roads are created for this number of decomposition level
		int decompositionLevelWithRoad = 1;
		// Road width
		double roadWidth = 5.0;
		// Boolean forceRoadaccess
		boolean forceRoadAccess = false;

		IPolygon pol = (IPolygon) FromGeomToSurface.convertGeom(WktGeOxygene.makeGeOxygene(strMuliPol)).get(0);
		
		OBBBlockDecomposition decomposition = new OBBBlockDecomposition(pol, maximalArea, maximalWidth, roadEpsilon, imC, decompositionLevelWithRoad, roadWidth, forceRoadAccess);
		IFeatureCollection<IFeature> featColl = decomposition.decompParcel(noise);

		ShapefileWriter.write(featColl, "/tmp/tmp.shp");

	}

}
